# Environment Variables Guide

## Overview

This project uses Vite's environment variable system with three configuration files:

- **`.env.development`** - Used when running `npm run dev` (local development)
- **`.env.production`** - Used when running `npm run build` (production builds)
- **`.env.example`** - Template/documentation for all available variables

## File Hierarchy

Vite loads environment variables in this priority order (highest to lowest):

1. `.env.local` (local overrides, **not committed** to git)
2. `.env.[mode].local` (e.g., `.env.development.local`, **not committed**)
3. `.env.[mode]` (e.g., `.env.development`, **committed** to git)
4. `.env` (base configuration, **committed** to git)

**Note**: We don't have a base `.env` file - we use mode-specific files instead.

## Current Configuration

### Development (`.env.development`)

```bash
VITE_API_BASE_URL=https://assurly-frontend-400616570417.europe-west2.run.app
VITE_DEBUG_API=true  # Enables console logging
```

**Usage**: Automatic when running `npm run dev`

### Production (`.env.production`)

```bash
VITE_API_BASE_URL=https://assurly-frontend-400616570417.europe-west2.run.app
VITE_DEBUG_API=false  # Disables console logging
```

**Usage**: Automatic when running `npm run build`

**Important**: These are **baked into the build** at compile time. To override in production:
- Set environment variables in **Vercel Dashboard** → Settings → Environment Variables
- Vercel variables take precedence over `.env.production`

### Example (`.env.example`)

Template showing all available variables with documentation.

**Usage**: 
- Copy to `.env.local` for local development overrides
- Reference when setting up new environments

## Available Variables

| Variable | Required | Description | Default |
|----------|----------|-------------|---------|
| `VITE_API_BASE_URL` | ✅ Yes | Backend API base URL | `https://assurly-frontend-400616570417.europe-west2.run.app` |
| `VITE_FRONTEND_URL` | ⬜ No | Frontend URL (for reference) | `https://www.assurly.co.uk` |
| `VITE_DEBUG_API` | ⬜ No | Enable API debug logging | `true` (dev), `false` (prod) |

## Local Development Overrides

To override settings locally without modifying committed files:

1. Copy `.env.example` to `.env.local`:
   ```bash
   cp .env.example .env.local
   ```

2. Edit `.env.local` with your custom values

3. `.env.local` is ignored by git and won't be committed

## Production Deployment (Vercel)

The `.env.production` file provides defaults, but **production environment variables must be set in Vercel**:

1. Go to https://vercel.com/dashboard
2. Select your project
3. Navigate to **Settings** → **Environment Variables**
4. Add required variables:
   - `VITE_API_BASE_URL` (Production checkbox ✅)
   - Optionally: `VITE_DEBUG_API=false` (Production checkbox ✅)
5. Redeploy after adding/changing variables

## Important Notes

### Vite Environment Variable Rules

1. **Must start with `VITE_`** prefix to be exposed to the browser
2. **Baked into build** at compile time (not runtime)
3. **Exposed to the browser** (never put secrets here!)
4. **Local `.env` files not used** in production builds

### Security

❌ **Never put secrets in these files!**
- All `VITE_*` variables are exposed to the browser
- For secrets, use backend environment variables
- Backend API should handle sensitive operations

### Common Mistakes

1. ❌ Forgetting to restart `npm run dev` after changing `.env` files
2. ❌ Expecting `.env` changes to affect production without rebuild
3. ❌ Putting different values in `.env.development` and Vercel (causes confusion)
4. ❌ Not setting variables in Vercel Dashboard (production will fail)

## Troubleshooting

### Check Current Environment Variables (Browser Console)

```javascript
console.log('API URL:', import.meta.env.VITE_API_BASE_URL);
console.log('Debug:', import.meta.env.VITE_DEBUG_API);
console.log('Mode:', import.meta.env.MODE);
```

### Variables Not Working?

1. **Development**: Restart `npm run dev`
2. **Production**: Rebuild and redeploy
3. **Vercel**: Check Dashboard → Settings → Environment Variables
4. **Browser**: Hard refresh (Cmd+Shift+R) or clear cache

### Wrong Environment Used?

```bash
# Force development mode
npm run dev

# Force production mode
npm run build && npm run preview
```

## Questions?

See:
- [Vite Environment Variables Docs](https://vitejs.dev/guide/env-and-mode.html)
- Project README: `../README.md`
- Backend configuration: `../assurly-backend/README.md`
